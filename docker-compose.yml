version: '3.8'

services:
  audiobook-sync:
    build: .
    image: audiobook-sync:latest
    container_name: audiobook-sync
    ports:
      - "5000:5000"
    volumes:
      - ./data:/data
    environment:
      # Audiobookshelf Configuration
      - ABS_URL=${ABS_URL:-}
      - ABS_TOKEN=${ABS_TOKEN:-}
      
      # StoryGraph Configuration
      - STORYGRAPH_EMAIL=${STORYGRAPH_EMAIL:-}
      - STORYGRAPH_PASSWORD=${STORYGRAPH_PASSWORD:-}
      
      # Hardcover Configuration
      - HARDCOVER_API_KEY=${HARDCOVER_API_KEY:-}
      
      # Sync Settings
      - SYNC_INTERVAL_MINUTES=${SYNC_INTERVAL_MINUTES:-60}
      - MIN_LISTEN_MINUTES=${MIN_LISTEN_MINUTES:-10}
      - ENABLE_STORYGRAPH=${ENABLE_STORYGRAPH:-true}
      - ENABLE_HARDCOVER=${ENABLE_HARDCOVER:-true}
      
      # Application Settings
      - DATABASE_URL=${DATABASE_URL:-sqlite:///data/audiobook-sync.db}
      - SECRET_KEY=${SECRET_KEY:-}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - TZ=${TZ:-UTC}
      - PORT=${PORT:-5000}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

# Optional: Use a separate volume for persistence
volumes:
  data:
